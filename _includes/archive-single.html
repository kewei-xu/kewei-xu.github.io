{% include base_path %}

{%- comment -%}
  Build a clean title (same as original logic)
{%- endcomment -%}
{% if post.id %}
  {% assign title = post.title | markdownify | remove: "<p>" | remove: "</p>" %}
{% else %}
  {% assign title = post.title %}
{% endif %}

{%- comment -%}
  Resolve preview image (left thumbnail): priority
  thumbnail > image > header.teaser > site.teaser
{%- endcomment -%}
{% assign preview_raw = post.thumbnail | default: post.image | default: post.header.teaser | default: site.teaser %}
{% if preview_raw %}
  {% if preview_raw contains "://" %}
    {% assign preview_url = preview_raw %}
  {% else %}
    {% assign preview_url = preview_raw | prepend: "/images/" | prepend: base_path %}
  {% endif %}
{% endif %}

<div class="{{ include.type | default: "list" }}__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">

    <div class="pub-item">
      {%- if preview_url -%}
      <div class="pub-thumb">
        <img src="{{ preview_url }}" alt="Preview image for {{ post.title }}">
      </div>
      {%- endif -%}

      <div class="pub-body">

        <h2 class="archive__item-title" itemprop="headline">
          {{ title }}
        </h2>

        {% if post.read_time %}
          <p class="page__meta"><i class="fa fa-clock" aria-hidden="true"></i> {% include read-time.html %}</p>
        {% endif %}

        {%- comment -%} ——— Author block (with link style & bold your name) ——— {%- endcomment -%}
        {%- if post.authors or post.author -%}
          <p class="page__meta author-line">
            <strong class="author-label">Authors: </strong>
            {%- if post.authors -%}
              {%- for a in post.authors -%}
                {%- assign name = a.name | default: a -%}
                {%- assign url = a.url  | default: "" -%}

                {%- if name contains "Kewei Xu" -%}
                  {%- assign name_html = "<strong>" | append: name | append: "</strong>" -%}
                {%- else -%}
                  {%- assign name_html = name -%}
                {%- endif -%}

                {%- if url != "" -%}
                  <a class="author-link" href="{{ url }}">{{ name_html }}</a>
                {%- else -%}
                  <span class="author-nolink">{{ name_html }}</span>
                {%- endif -%}

                {%- unless forloop.last -%}, {% endunless -%}
              {%- endfor -%}
            {%- else -%}
              {{ post.author }}
            {%- endif -%}
          </p>
        {%- endif -%}

        {%- comment -%} ——— Venue / Date ——— {%- endcomment -%}
        {% if post.collection == 'teaching' %}
          <p> {{ post.type }}, <i>{{ post.venue }}</i>, {{ post.date | default: "1900-01-01" | date: "%Y" }} </p>
        {% elsif post.collection == 'publications' %}
          <p>Published in <i>{{ post.venue }}</i>, {{ post.date | default: "1900-01-01" | date: "%Y" }} </p>
        {% elsif post.date %}
          <p class="page__date">
            <strong>
              <i class="fa fa-fw fa-calendar" aria-hidden="true"></i>
              {{ site.data.ui-text[site.locale].date_label | default: "Published:" }}
            </strong>
            <time datetime="{{ post.date | default: "1900-01-01" | date_to_xmlschema }}">
              {{ post.date | default: "1900-01-01" | date: "%B %d, %Y" }}
            </time>
          </p>
        {% endif %}

        {%- comment -%} ——— Excerpt ——— {%- endcomment -%}
        {% if post.excerpt and site.read_more != 'enabled' %}
          <p class="archive__item-excerpt" itemprop="description">{{ post.excerpt | markdownify }}</p>
        {% elsif post.excerpt and site.read_more == 'enabled' %}
          <p class="archive__item-excerpt" itemprop="description">
            <p>{{ post.excerpt | markdownify | remove: '<p>' | remove: '</p>' }}<strong><a href="{{ base_path }}{{ post.url }}" rel="permalink"> Read more</a></strong></p>
          </p>
        {% endif %}

        {%- comment -%}
          ——— Links block:
          Prefer Author version > DOI > Paper; plus Slides / BibTeX; include citation if present
        {%- endcomment -%}
        {%- assign links = "" -%}

        {%- if post.author_version_url -%}
          {%- assign links = links | append: '<a href="' | append: post.author_version_url | append: '">Author version</a>' -%}
        {%- elsif post.doi -%}
          {%- assign doi_url = post.doi -%}
          {%- unless post.doi contains 'http' or post.doi contains 'doi.org' -%}
            {%- assign doi_url = 'https://doi.org/' | append: post.doi -%}
          {%- endunless -%}
          {%- assign links = links | append: '<a href="' | append: doi_url | append: '">DOI</a>' -%}
        {%- elsif post.paperurl -%}
          {%- assign links = links | append: '<a href="' | append: post.paperurl | append: '">Paper</a>' -%}
        {%- endif -%}

        {%- if post.slidesurl -%}
          {%- if links != "" -%}{%- assign links = links | append: ' | ' -%}{%- endif -%}
          {%- assign links = links | append: '<a href="' | append: post.slidesurl | append: '">Slides</a>' -%}
        {%- endif -%}

        {%- if post.bibtexurl -%}
          {%- if links != "" -%}{%- assign links = links | append: ' | ' -%}{%- endif -%}
          {%- assign links = links | append: '<a href="' | append: post.bibtexurl | append: '">BibTeX</a>' -%}
        {%- endif -%}

        {%- if post.citation -%}
          <p>Recommended citation: {{ post.citation }}<br />{{ links }}</p>
        {%- elsif links != "" -%}
          <p>{{ links }}</p>
        {%- endif -%}

      </div> <!-- /.pub-body -->
    </div>   <!-- /.pub-item -->

  </article>
</div>
